---
import Layout from "../layouts/Layout.astro";
import ContactCTA from "../components/ContactCTA.astro";
import { getCollection } from "astro:content";

const casos = (await getCollection("casos"))
  .sort((a, b) => a.data.order - b.data.order)
  .slice(0, 3);

const otrosCasos = (await getCollection("otros-casos"))
  .sort((a, b) => a.data.order - b.data.order);
---

<Layout
  title="Casos de 茅xito | JJMontalban"
  page="page-casos"
  description="Casos reales de proyectos WordPress: integraciones avanzadas, plugins a medida, automatizaci贸n y soluciones t茅cnicas en producci贸n."
>
  <div class="container">
    <section class="content-container">
      <h1>Casos de 茅xito</h1>

      <p class="lead">
        Proyectos reales desarrollados sobre WordPress: integraciones, ampliaciones,
        automatizaci贸n y arquitectura t茅cnica pensada para producci贸n.
      </p>

      <div class="cases-list">
        {casos.map(({ slug, data }, index) => (
          <article class={`case-item ${index % 2 !== 0 ? "reverse" : ""}`}>
            <div class="case-image">
              {data.image && (
                <img
                  src={data.image}
                  alt={data.title}
                  loading="lazy"
                />
              )}
            </div>

            <div class="case-content">
              <h2>{data.title}</h2>

              {data.desc.map(item => (
                <p class="case-desc">{item}</p>
              ))}

              <ul class="case-tech">
                {data.tech.map(tech => (
                  <li>{tech}</li>
                ))}
              </ul>

              <div class="case-actions">
                {data.link && (
                  <a
                    href={data.link}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="case-icon"
                    aria-label="Ver proyecto online"
                  >
                    
                  </a>
                )}

                <a href={`/casos/${slug}`} class="cta">
                  Ver caso
                </a>
              </div>
            </div>
          </article>
        ))}
      </div>
    </section>

    <section class="other-cases">
      <h2>Otros casos</h2>

      <div class="other-cases-grid">
        {otrosCasos.map(({ data }) => (
          <a
            href={data.link}
            target="_blank"
            rel="noopener noreferrer"
            class="other-case-card"
          >
            <div class="other-case-image">
              <img
                src={data.image}
                alt={data.title}
                loading="lazy"
              />
            </div>

            <div class="other-case-content">
              <h3>{data.title}</h3>
              <p>{data.excerpt}</p>
            </div>
          </a>
        ))}
      </div>
    </section>

    <ContactCTA
      title="驴Quieres resultados similares?"
      text="Estos proyectos partieron de una conversaci贸n como esta."
    />
  </div>
</Layout>
