---
import Layout from "../layouts/Layout.astro";
---

<Layout
  title="Contacto | JJ Montalban"
  page="page-contacto"
  description="Contacta para desarrollo WordPress especializado en plugins a medida, integraciones y mejoras técnicas avanzadas."
>
  <div class="container">
    <div class="content-container">
      <h1>Hablemos</h1>

      <p class="lead">
        Cuéntame qué necesitas y te responderé con una
        propuesta clara.
      </p>

      <section class="items-container">
        <div class="contact-card">
          <form
            class="contact-form"
            action="https://formspree.io/f/mzdbogkk"
            method="POST"
          >
            <label for="name">Nombre</label>
            <input
              id="name"
              name="name"
              type="text"
              placeholder="Tu nombre"
              required
            />

            <label for="email">Email</label>
            <input
              id="email"
              name="_replyto"
              type="email"
              placeholder="tu@email.com"
              required
            />

            <p class="optional-note">
              Me cuentas algo más? (Campos opcionales).
            </p>
            <button
              type="button"
              class="toggle-optional cta"
              aria-expanded="false"
              aria-controls="optional-fields"
            >
              Añadir más detalles del proyecto (opcional)
            </button>

            <div id="optional-fields" class="optional-fields" hidden>
              <fieldset class="optional-group">
                <legend>Tipo de proyecto</legend>
                <label>
                  <input type="checkbox" name="project_type[]" value="Web corporativa" />
                  Web corporativa
                </label>
                <label>
                  <input type="checkbox" name="project_type[]" value="E-commerce" />
                  E-commerce
                </label>
                <label>
                  <input type="checkbox" name="project_type[]" value="Plugin / desarrollo a medida" />
                  Plugin / desarrollo a medida
                </label>
                <label>
                  <input type="checkbox" name="project_type[]" value="Aplicación web / sistema a medida" />
                  Aplicación web / sistema a medida
                </label>
                <label>
                  <input type="checkbox" name="project_type[]" value="No lo tengo claro" />
                  No lo tengo claro
                </label>
              </fieldset>

              <label for="has-website">¿Tienes ya una web?</label>
              <select id="has-website" name="has_website">
                <option value="" selected>Selecciona una opción</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
                <option value="En desarrollo">En desarrollo</option>
              </select>

              <div class="optional-dependent" data-show="has-website" hidden>
                <label for="current-url">URL del sitio actual</label>
                <input id="current-url" name="current_url" type="url" />
              </div>

              <div class="optional-dependent" data-show="has-website" hidden>
                <label for="current-hosting">Hosting actual</label>
                <input
                  id="current-hosting"
                  name="current_hosting"
                  type="text"
                  placeholder="Ej: SiteGround, Raiola, OVH, desconocido"
                />
              </div>

              <div class="optional-dependent" data-show="has-website" hidden>
                <label for="experience-level">
                  Nivel de experiencia gestionando tu web actual
                </label>
                <select id="experience-level" name="experience_level">
                  <option value="" selected>Selecciona una opción</option>
                  <option value="Ninguna">Ninguna</option>
                  <option value="Básica (publicar contenidos)">
                    Básica (publicar contenidos)
                  </option>
                  <option value="Media (edición, ajustes, plugins)">
                    Media (edición, ajustes, plugins)
                  </option>
                  <option value="Avanzada">Avanzada</option>
                </select>
              </div>

              <label for="agency-collab">
                ¿Trabajaremos junto a una agencia o estudio de diseño?
              </label>
              <select id="agency-collab" name="agency_collaboration">
                <option value="" selected>Selecciona una opción</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>

              <div class="optional-dependent" data-show="agency-yes" hidden>
                <label for="agency-name">Nombre de la agencia o estudio</label>
                <input id="agency-name" name="agency_name" type="text" />
              </div>

              <fieldset class="optional-group optional-dependent" data-show="agency-no" hidden>
                <legend>Material corporativo disponible</legend>
                <label>
                  <input type="checkbox" name="brand_assets[]" value="Logotipo" />
                  Logotipo
                </label>
                <label>
                  <input type="checkbox" name="brand_assets[]" value="Colores corporativos" />
                  Colores corporativos
                </label>
                <label>
                  <input type="checkbox" name="brand_assets[]" value="Tipografías" />
                  Tipografías
                </label>
                <label>
                  <input type="checkbox" name="brand_assets[]" value="Manual de marca" />
                  Manual de marca
                </label>
                <label>
                  <input type="checkbox" name="brand_assets[]" value="Fotografías profesionales" />
                  Fotografías profesionales
                </label>
                <label>
                  <input type="checkbox" name="brand_assets[]" value="Ninguno / por definir" />
                  Ninguno / por definir
                </label>
              </fieldset>

              <label for="message">Mensaje</label>
              <textarea
                id="message"
                name="message"
                rows="5"
                placeholder="Cuéntame sobre tu proyecto"
              ></textarea>
            </div>

            <input type="hidden" name="_subject" value="Nuevo mensaje desde la web" />
            <input type="hidden" name="_redirect" value="https://tudominio.com/gracias" />
            <input type="text" name="_gotcha" style="display:none" />

            <button type="submit" class="cta">
              Enviar
            </button>
          </form>
        </div>
      </section>
    </div>
  </div>

  <script>
    const toggleButton = document.querySelector(".toggle-optional");
    const optionalFields = document.getElementById("optional-fields");
    const hasWebsiteSelect = document.getElementById("has-website");
    const agencySelect = document.getElementById("agency-collab");

    const updateWebsiteDependencies = () => {
      if (!hasWebsiteSelect) {
        return;
      }
      const shouldShow = ["Sí", "En desarrollo"].includes(hasWebsiteSelect.value);
      document
        .querySelectorAll('[data-show="has-website"]')
        .forEach((field) => field.toggleAttribute("hidden", !shouldShow));
    };

    const updateAgencyDependencies = () => {
      if (!agencySelect) {
        return;
      }
      const isYes = agencySelect.value === "Sí";
      document
        .querySelectorAll('[data-show="agency-yes"]')
        .forEach((field) => field.toggleAttribute("hidden", !isYes));
      document
        .querySelectorAll('[data-show="agency-no"]')
        .forEach((field) => field.toggleAttribute("hidden", isYes || !agencySelect.value));
    };

    if (toggleButton && optionalFields) {
      toggleButton.addEventListener("click", () => {
        const isHidden = optionalFields.toggleAttribute("hidden");
        toggleButton.textContent = isHidden
          ? "Añadir más detalles del proyecto (opcional)"
          : "Ocultar detalles del proyecto";
        toggleButton.setAttribute("aria-expanded", String(!isHidden));
        if (!isHidden) {
          updateWebsiteDependencies();
          updateAgencyDependencies();
        } else {
          // Cuando se oculta, resetear los selects y ocultar campos dependientes
          if (hasWebsiteSelect) hasWebsiteSelect.value = "";
          if (agencySelect) agencySelect.value = "";
          document
            .querySelectorAll('.optional-dependent')
            .forEach((field) => field.setAttribute("hidden", ""));
        }
      });
    }

    if (hasWebsiteSelect) {
      hasWebsiteSelect.addEventListener("change", updateWebsiteDependencies);
    }

    if (agencySelect) {
      agencySelect.addEventListener("change", updateAgencyDependencies);
    }

    // Asegurar que los campos condicionales estén ocultos al cargar la página
    document
      .querySelectorAll('.optional-dependent')
      .forEach((field) => field.setAttribute("hidden", ""));
  </script>
</Layout>
