---
import Layout from "../layouts/Layout.astro";
import ContactCTA from "../components/ContactCTA.astro";
import { getCollection } from "astro:content";

import { getIconData, iconToSVG } from "@iconify/utils";
import { icons as simpleIcons } from "@iconify-json/simple-icons";

/* ========================================================= */
/* ICONS                                                     */
/* ========================================================= */

const wordpress = iconToSVG(getIconData(simpleIcons, "wordpress"), { width:24 });
const php = iconToSVG(getIconData(simpleIcons, "php"), { width:24 });
const mysql = iconToSVG(getIconData(simpleIcons, "mysql"), { width:24 });
const javascript = iconToSVG(getIconData(simpleIcons, "javascript"), { width:24 });
const woocommerce = iconToSVG(getIconData(simpleIcons, "woocommerce"), { width:24 });
const mailchimp = iconToSVG(getIconData(simpleIcons, "mailchimp"), { width:24 });
const googlecalendar = iconToSVG(getIconData(simpleIcons, "googlecalendar"), { width:24 });

/* ========================================================= */
/* CONTENT                                                   */
/* ========================================================= */

const casos = (await getCollection("casos"))
  .sort((a,b)=>a.data.order-b.data.order);

const otrosCasos = (await getCollection("otros-casos"))
  .sort((a,b)=>a.data.order-b.data.order);
---

<Layout
  title="Casos de éxito | JJMontalban"
  page="page-casos"
  description="Casos reales de proyectos WordPress: integraciones avanzadas, plugins a medida y soluciones técnicas en producción."
>
  <div class="container">
    <section class="content-container">
      <h1>Casos de éxito</h1>

      <p class="lead">
        Proyectos reales de desarrollo a medida: integraciones complejas,
        soluciones técnicas y arquitectura estable en producción.
      </p>

      <div class="cases-list">
        {casos.map(({ slug, data }, index) => (
          <article class={`case-item ${index % 2 !== 0 ? "reverse" : ""}`}>
            <div class="case-image">
              {data.image && (
                <img src={data.image} alt={data.title} loading="lazy" />
              )}
            </div>

            <div class="case-content">
              <h2>{data.title}</h2>

              {data.intro?.map(item => (
                <p class="case-desc">{item}</p>
              ))}

              <div class="case-tech-row">
                <ul class="case-tech">

                  {slug === "chipicasa" && (
                    <>
                      <li class="case-tech-icon">
                        <svg viewBox="0 0 24 24" set:html={wordpress.body} />
                        <span class="sr-only">wordpress</span>
                      </li>
                      <li class="case-tech-icon">
                        <svg viewBox="0 0 24 24" set:html={php.body} />
                        <span class="sr-only">php</span>
                      </li>
                      <li class="case-tech-icon">
                        <svg viewBox="0 0 24 24" set:html={mysql.body} />
                        <span class="sr-only">mysql</span>
                      </li>
                    </>
                  )}

                  {slug === "brunimarsa" && (
                    <>
                      <li class="case-tech-icon">
                        <svg viewBox="0 0 24 24" set:html={wordpress.body} />
                        <span class="sr-only">wordpress</span>
                      </li>
                      <li class="case-tech-icon">
                        <svg viewBox="0 0 24 24" set:html={php.body} />
                        <span class="sr-only">php</span>
                      </li>
                      <li class="case-tech-icon">
                        <svg viewBox="0 0 24 24" set:html={mailchimp.body} />
                        <span class="sr-only">mailchimp api</span>
                      </li>
                    </>
                  )}

                  {slug === "caramelotattoo" && (
                    <>
                      <li class="case-tech-icon">
                        <svg viewBox="0 0 24 24" set:html={wordpress.body} />
                        <span class="sr-only">wordpress</span>
                      </li>
                      <li class="case-tech-icon">
                        <svg viewBox="0 0 24 24" set:html={php.body} />
                        <span class="sr-only">php</span>
                      </li>
                      <li class="case-tech-icon">
                        <svg viewBox="0 0 24 24" set:html={googlecalendar.body} />
                        <span class="sr-only">google calendar api</span>
                      </li>
                    </>
                  )}

                  {slug === "eresagua" && (
                    <>
                      <li class="case-tech-icon">
                        <svg viewBox="0 0 24 24" set:html={wordpress.body} />
                        <span class="sr-only">wordpress</span>
                      </li>
                      <li class="case-tech-icon">
                        <svg viewBox="0 0 24 24" set:html={woocommerce.body} />
                        <span class="sr-only">woocommerce</span>
                      </li>
                      <li class="case-tech-icon">
                        <svg viewBox="0 0 24 24" set:html={javascript.body} />
                        <span class="sr-only">javascript</span>
                      </li>
                    </>
                  )}

                </ul>

                <a href={`/casos/${slug}`} class="cta">
                  Ver detalle del proyecto
                </a>
              </div>
            </div>
          </article>
        ))}
      </div>
    </section>

    <section class="other-cases">
      <h2>Otros casos</h2>

      <div class="other-cases-grid">
        {otrosCasos.map(({ data }) => (
          <a
            href={data.link}
            target="_blank"
            rel="noopener noreferrer"
            class="other-case-card"
          >
            <div class="other-case-image">
              <img src={data.image} alt={data.title} loading="lazy" />
            </div>

            <div class="other-case-content">
              <h3>{data.title}</h3>
              <p>{data.excerpt}</p>
            </div>
          </a>
        ))}
      </div>
    </section>

    <ContactCTA
      title="¿Quieres resultados similares?"
      text="Estos proyectos partieron de una conversación como esta."
    />
  </div>
</Layout>

