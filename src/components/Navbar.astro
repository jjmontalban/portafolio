---
import { x } from "../lib/icons";
import LanguageSwitch from "./LanguageSwitch.astro";
import { getLangFromUrl, useTranslations, getLangPrefix, getLocalizedRoute } from '../lib/i18n/utils';

interface Props {
  current?: string;
}

const { current } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const prefix = getLangPrefix(lang);
---

<nav class="navbar">
  <a href={prefix + '/'}>
    <img class="site-logo" src="/images/jj.webp" alt="JJ" width="40" height="40" fetchpriority="high" />
  </a>

  <button class="burger" aria-label={t('nav.openMenu')} aria-expanded="false" aria-controls="site-navigation" type="button">☰</button>

  <div id="site-navigation" class="nav-links" role="navigation">
    <button class="nav-close" aria-label={t('nav.closeMenu')} type="button">
      <svg class="nav-close-icon" viewBox="0 0 24 24" set:html={x.body} />
    </button>

    <!-- Language switch MÓVIL (solo en menú móvil) -->
    <div class="nav-lang-mobile">
      <LanguageSwitch />
    </div>

    <a href={prefix + '/'} class:list={{ selected: current === "home" }}>{t('nav.inicio')}</a>
    <a href={getLocalizedRoute(lang, 'services')} class:list={{ selected: current === "servicios" }}>{t('nav.servicios')}</a>
    <a href={getLocalizedRoute(lang, 'cases')} class:list={{ selected: current === "casos" }}>{t('nav.casos')}</a>
    <a href={getLocalizedRoute(lang, 'plugins')} class:list={{ selected: current === "plugins" }}>{t('nav.plugins')}</a>
    <a href={getLocalizedRoute(lang, 'contact')} class:list={{ selected: current === "contacto" }}>{t('nav.contacto')}</a>

    <!-- Language switch DESKTOP (al final de los enlaces) -->
    <div class="nav-lang-desktop">
      <LanguageSwitch />
    </div>
  </div>
</nav>
