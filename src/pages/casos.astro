---
import Layout from "../layouts/Layout.astro";
import ContactCTA from "../components/ContactCTA.astro";
import { getCollection } from "astro:content";
import {
  siGooglecalendar,
  siJavascript,
  siMailchimp,
  siMysql,
  siPhp,
  siPrestashop,
  siVuedotjs,
  siWhatsapp,
  siWoocommerce,
  siWordpress,
} from "simple-icons";

const casos = (await getCollection("casos"))
  .sort((a, b) => a.data.order - b.data.order);

const otrosCasos = (await getCollection("otros-casos"))
  .sort((a, b) => a.data.order - b.data.order);

const techIcons = {
  WordPress: siWordpress,
  PHP: siPhp,
  JavaScript: siJavascript,
  "Mailchimp API": siMailchimp,
  "Google Calendar API": siGooglecalendar,
  MySQL: siMysql,
  WooCommerce: siWoocommerce,
  PrestaShop: siPrestashop,
  "Vue.js": siVuedotjs,
  WhatsApp: siWhatsapp,
  "WhatsApp API": siWhatsapp,
};

const caseStacks = {
  chipicasa: [
    "WordPress",
    "PHP",
    "MySQL",
    "WP REST API",
    "Custom plugins",
    "XML portal feeds",
  ],
  brunimarsa: [
    "WordPress",
    "PHP",
    "Contact Form 7",
    "Mailchimp API",
    "Custom plugin",
  ],
  caramelotattoo: [
    "WordPress",
    "PHP",
    "Google Calendar API",
    "Custom plugin",
  ],
  eresagua: [
    "WordPress",
    "WooCommerce",
    "PHP",
    "JavaScript",
    "WP REST API",
  ],
};



// Simple Icons no incluye: Contact Form 7, Storefront, Custom plugin, Custom plugins, Custom theme,
// Responsive design, XML portal feeds, WP REST API, REST API.

const getTechIcon = tech => techIcons[tech];
---

<Layout
  title="Casos de éxito | JJMontalban"
  page="page-casos"
  description="Casos reales de proyectos WordPress: integraciones avanzadas, plugins a medida y soluciones técnicas en producción."
>
  <div class="container">
    <section class="content-container">
      <h1>Casos de éxito</h1>

      <p class="lead">
        Proyectos reales de desarrollo a medida: integraciones complejas,
        soluciones técnicas y arquitectura estable en producción.
      </p>

      <div class="cases-list">
        {casos.map(({slug,data},index)=>(
          <article class={`case-item ${index%2!==0?"reverse":""}`}>
            <div class="case-image">
              {data.image&&(
                <img
                  src={data.image}
                  alt={data.title}
                  loading="lazy"
                />
              )}
            </div>

            <div class="case-content">
              <h2>{data.title}</h2>

              {data.intro?.map(item=>(
                <p class="case-desc">{item}</p>
              ))}

              <div class="case-tech-row">
                {caseStacks[slug]?.length && (
                <ul class="case-tech">
                  {caseStacks[slug].map(tech => {
                    const icon = getTechIcon(tech);

                    return icon ? (
                      <li
                        class="case-tech-icon"
                        title={tech}
                        aria-label={tech}
                      >
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                          <path d={icon.path} />
                        </svg>
                      </li>
                    ) : null;
                  })}
                </ul>
              )}

                <a href={`/casos/${slug}`} class="cta">
                  Ver detalle del proyecto
                </a>
              </div>
            </div>
          </article>
        ))}
      </div>
    </section>

    <section class="other-cases">
      <h2>Otros casos</h2>

      <div class="other-cases-grid">
        {otrosCasos.map(({data})=>(
          <a
            href={data.link}
            target="_blank"
            rel="noopener noreferrer"
            class="other-case-card"
          >
            <div class="other-case-image">
              <img
                src={data.image}
                alt={data.title}
                loading="lazy"
              />
            </div>

            <div class="other-case-content">
              <h3>{data.title}</h3>
              <p>{data.excerpt}</p>
            </div>
          </a>
        ))}
      </div>
    </section>

    <ContactCTA
      title="¿Quieres resultados similares?"
      text="Estos proyectos partieron de una conversación como esta."
    />
  </div>
</Layout>
